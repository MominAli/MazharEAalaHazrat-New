<app-loader [loading]="loading"></app-loader>
<div *ngIf="!loading">
  <app-hero-banner
    [title]="'Books Library'"
    [subtitle]="'Explore, read, and download your favorite books'">
  </app-hero-banner>

  <div class="container">
    <!-- ðŸ” Search Box -->
    <div class="row">
      <div class="col-md-12">
        <div class="search-box my-3 search-container">
          <input
            type="text"
            class="form-control me-2"
            placeholder="Search books..."
            [(ngModel)]="searchQuery"
            (input)="filterBooks()" />
          <button class="search-btn" (click)="filterBooks()">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- ðŸ“š Book Grid -->
    <div class="row">
      <div
        *ngFor="let item of filteredBooks | paginate: { id: 'content-pagination', itemsPerPage: itemsPerPage, currentPage: currentPage }"
        class="col-xl-3 col-lg-4 col-md-4 col-sm-6 col-6 text-center my-3 px-2">
        <div class="card book-card" tabindex="0">
          <div class="card-img-wrapper">
            <img
              [src]="item.img"
              [alt]="item.title || 'Book Image'"
              loading="lazy"
              class="card-img-top"
              (click)="navigateToBook(item)"
              style="cursor: pointer;" />
          </div>

          <div class="card-body">
            <h5 class="text-truncate" [attr.title]="item.title">{{ item.title }}</h5>

            <div
              class="d-flex mt-3 flex-wrap gap-2"
              [ngClass]="{
                'justify-content-center': item.hasChildren,
                'justify-content-between': !item.hasChildren
              }">
              <button
                class="btn btn-sm"
                *ngIf="item.hasChildren"
                (click)="navigateToBook(item)">
                <i class="fas fa-layer-group fa-fw"></i> View Volumes
              </button>

              <button
                class="btn btn-sm"
                *ngIf="!item.hasChildren"
                (click)="navigateToBook(item)">
                <i class="fas fa-book-open fa-fw"></i> Read
              </button>

              <button
  class="btn btn-success btn-sm"
  *ngIf="!item.hasChildren && item.pdfPath"
  [disabled]="downloadingMap[item.title]"
  (click)="downloadPDF(item.pdfPath, item.title)">
  <i class="fas fa-file-pdf fa-fw"></i>
  {{ downloadingMap[item.title] ? 'Downloading...' : 'Download' }}
</button>


            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸ“„ Pagination -->
    <div class="pagination-wrapper mt-4 d-flex justify-content-center">
      <pagination-controls
        id="content-pagination"
        (pageChange)="currentPage = $event"
        class="pagination"
        previousLabel="Previous"
        nextLabel="Next">
      </pagination-controls>
    </div>
  </div>
</div>
<app-footer></app-footer>
